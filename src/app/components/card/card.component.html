<section
  cdkDrag
  [cdkDragDisabled]="is_archived"
  class="relative flex flex-col rounded-md bg-slate-50 text-slate-700 shadow-sm"
  [class.opacity-60]="is_archived"
  [class.cursor-not-allowed]="is_archived"
>
  <div
    class="relative flex items-center justify-center rounded-t-md bg-slate-300 px-4 py-1 text-slate-50"
  >
    <img
      cdkDragHandle
      ngSrc="/icons/grip-horizontal.svg"
      alt="Mover tarjeta"
      width="22"
      height="22"
      class="cursor-grab"
    />
    <div class="absolute right-2 top-1/2 -translate-y-1/2">
      <button
        (click)="toggleMenu($event)"
        class="flex aspect-square p-1 items-center justify-center rounded-md text-slate-50 transition-all duration-150 hover:bg-slate-200/40"
        type="button"
      >
        <img
          ngSrc="/icons/menu-2.svg"
          alt="Abrir menÃº de acciones"
          width="16"
          height="16"
        />
      </button>
      <div
        *ngIf="isActionMenuOpen"
        (click)="$event.stopPropagation()"
        class="absolute right-0 top-6 z-20 flex w-44 flex-col rounded-md border border-slate-300 bg-white text-sm text-slate-700 shadow-2xl"
      >
        <button
          type="button"
          class="flex items-center gap-2 px-4 py-2 text-left transition hover:bg-slate-100"
          (click)="toggleArchiveState($event)"
        >
          <img
            ngSrc="/icons/{{ is_archived ? 'archive-off' : 'archive' }}.svg"
            alt="{{ is_archived ? 'Desarchivar' : 'Archivar' }}"
            width="16"
            height="16"
          />
          {{ is_archived ? 'Desarchivar' : 'Archivar' }}
        </button>
        <button
          type="button"
          class="flex items-center gap-2 px-4 py-2 text-left transition hover:bg-slate-100"
          (click)="deleteCard($event)"
        >
          <img ngSrc="/icons/delete.svg" alt="Eliminar" width="16" height="16" />
          Eliminar
        </button>
      </div>
    </div>
  </div>

  <div class="flex flex-col gap-2 border border-slate-200 border-t-0 rounded-b-md p-4">
    <h3
      [attr.id]="getElementId('title')"
      (blur)="saveCard()"
      [attr.contenteditable]="is_archived ? 'false' : 'true'"
      class="cursor-text border-b-2 border-slate-200 text-xl font-semibold break-all text-neutral-800 selection:bg-sky-600 selection:text-neutral-100 focus:outline-hidden"
    >
      {{ title }}
    </h3>
    <p
      [attr.id]="getElementId('description')"
      (blur)="saveCard()"
      [attr.contenteditable]="is_archived ? 'false' : 'true'"
      class="cursor-text break-all text-neutral-800 selection:bg-sky-600 selection:text-neutral-100 focus:outline-hidden"
    >
      {{ description }}
    </p>

    <div
      class="mt-2 flex flex-wrap items-center justify-between gap-4 text-xs text-slate-600"
    >
      <div class="flex items-center gap-2 text-sm text-slate-700">
        <label class="font-semibold">Prioridad:</label>
        <select
          [attr.id]="getElementId('priority')"
          (change)="saveCard()"
          [value]="priority"
          [disabled]="is_archived"
          class="rounded-xs bg-transparent"
        >
          <option value="low">Baja</option>
          <option value="medium">Media</option>
          <option value="high">Alta</option>
        </select>
      </div>
      <div class="flex flex-col gap-0.5 text-right">
        <span>Creada: {{ createdAt | date: 'dd/MM/yyyy HH:mm' }}</span>
        <span>Actualizada: {{ updatedAt | date: 'dd/MM/yyyy HH:mm' }}</span>
      </div>
    </div>
  </div>
</section>
